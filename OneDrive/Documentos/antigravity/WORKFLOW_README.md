# Supabase Agent via n8n (Projeto: FEVEREIRO_NEW)

Este diretório contém um workflow do n8n projetado para atuar como um agente que gerencia sua tabela `documents` no projeto **FEVEREIRO_NEW** no Supabase.

## Arquivos
- `supabase_agent_workflow.json`: O arquivo de definição do workflow para importar no n8n.

## Pré-requisitos

1.  **Instância n8n**: `https://n8n.srv1067081.hstgr.cloud`
2.  **Conta Supabase**:
    - URL do Projeto
    - Chave de API (Service Role Key recomendada para operações administrativas, ou Anon Key se tiver RLS configurado).

## Configuração do Banco de Dados (Supabase)

Você deve ter a tabela `documents` e recomendamos a tabela `logs_agente`.

### 1. Tabela `documents`
Esta tabela armazenará os documentos. Exemplo de estrutura:
```sql
create table public.documents (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  title text,
  content text,
  metadata jsonb
);
```

### 2. Tabela `logs_agente`
Esta tabela é usada para auditoria das operações realizadas pelo agente.
```sql
create table public.logs_agente (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  operation text,
  status text,
  details jsonb,
  timestamp timestamp with time zone
);
```

## Como Importar no n8n

1.  Abra seu editor n8n.
2.  Clique no menu "Workflow" (canto superior direito) > "Import from File".
3.  Selecione o arquivo `supabase_agent_workflow.json` deste diretório.

## Configuração de Credenciais

Após importar, você verá que os nós do Supabase estão reclamando de credenciais faltantes.
1.  Dê um duplo clique em qualquer nó "Supabase".
2.  Em "Credential for Supabase API", selecione "Create New".
3.  Insira:
    - **URL**: Sua URL do Supabase (ex: `https://xyz.supabase.co`).
    - **Key**: Sua chave de API.
4.  Salve a credencial.

## Uso da API (Webhook)

O workflow expõe um Webhook POST.

**URL de Teste:** `https://n8n.srv1067081.hstgr.cloud/webhook-test/agent`
**URL de Produção:** `https://n8n.srv1067081.hstgr.cloud/webhook/agent`

### Exemplos de Requisição

#### Criar (Create)
```json
{
  "operation": "create",
  "data": {
    "title": "Relatório Mensal",
    "content": "Conteúdo do relatório...",
    "metadata": { "autor": "Agente" }
  }
}
```

#### Ler (Read)
```json
{
  "operation": "read"
}
```

#### Atualizar (Update)
```json
{
  "operation": "update",
  "id": 1,
  "data": {
    "content": "Conteúdo atualizado"
  }
}
```

#### Deletar (Delete)
```json
{
  "operation": "delete",
  "id": 1
}
```
